<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPCC Methodology Popup Demo</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ======================================================= */
        /* MODAL SPECIFIC STYLES (New) */
        /* ======================================================= */
        #modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* Dark, transparent overlay */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s;
        }
        .hidden-modal {
            visibility: hidden;
            opacity: 0;
        }
        #modal-content-box {
            max-width: 90vw; /* Responsive width */
            max-height: 90vh; /* Responsive height */
            width: 800px; /* Max width for desktop */
            background-color: #1e1e1e; /* Modal background matches current content file */
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 182, 76, 0.2);
            overflow-y: auto; /* Allows scrolling inside the modal */
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* ======================================================= */
        /* EXISTING CONTENT STYLES (Adapted) */
        /* ======================================================= */
        
        /* Base Content Styles */
        body { font-family: ui-sans-serif, system-ui; background-color: #121212; color: #e0e0e0; padding: 0; margin: 0; }
        #modal-content-box .content-body { padding: 1.5rem; }
        h1, h2, h3 { color: #00b64c; margin-bottom: 0.5rem; }
        
        /* Interactive Glossary (Method 1) Styles */
        .term {
            cursor: help;
            border-bottom: 2px dashed #00b64c;
            position: relative;
            display: inline-block;
            font-weight: bold;
        }
        .tooltip-box {
            position: absolute;
            left: 50%;
            top: 120%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 1000;
            font-size: 0.85rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            border: 1px solid #00b64c;
        }
        .term:hover .tooltip-box {
            opacity: 1;
            visibility: visible;
        }

        /* Dynamic Diagram (Method 3) Styles */
        .diagram-container {
            position: relative;
            max-width: 600px;
            margin: 1.5rem auto;
            border: 1px solid #333;
            border-radius: 8px;
            overflow: hidden;
            min-height: 250px; /* Increased height to ensure diagram visibility */
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #2a2a2a;
            
            /* CSS REPLACEMENT FOR MISSING IMAGE */
            background-image: url('https://placehold.co/600x250/1e1e1e/00b64c?text=GHG+Protocol+Scopes+1%2C+2%2C+3+Diagram'); 
            background-size: cover;
            background-position: center;
        }
        .diagram-container img {
            /* Hiding the non-functional img tag, relying on background */
            display: none; 
        }
        .diagram-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        .scope-hotspot {
            position: absolute;
            background: rgba(0, 182, 76, 0.2); 
            border: 2px dashed #00b64c;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .scope-hotspot:hover {
            opacity: 1;
        }
        .loading-text {
            color: #ccc;
            font-style: italic;
            padding: 1rem;
        }
        .useful-link {
            color: #00b64c;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    
    <!-- DEMO BUTTON (To trigger the modal on this demo page) -->
    <button onclick="openModal()" class="fixed top-4 left-4 bg-[#00b64c] text-white p-3 rounded-lg shadow-xl hover:bg-opacity-80 z-[10000]">
        Show Methodology (Click Me)
    </button>
    <!-- End Demo Button -->

    <!-- MODAL BACKDROP (The main wrapper that closes the modal) -->
    <div id="modal-backdrop" class="hidden-modal" onclick="closeModal(event)">
        <!-- MODAL CONTENT BOX (This is the small window) -->
        <div id="modal-content-box" onclick="event.stopPropagation()">
            <!-- START OF ORIGINAL METHODOLOGY CONTENT -->
            <div class="content-body text-gray-200">
                <h1 class="text-2xl font-bold mb-4">üåç IPCC Carbon Counting ‚Äî Methodology</h1>
                
                <!-- ======================================================= -->
                <!-- 1. What is Carbon Counting & 2. What is IPCC -->
                <!-- ======================================================= -->
                <h2 class="text-xl font-semibold mt-4 mb-2">1 \& 2. The Foundation: What is Carbon Counting and the IPCC?</h2>
                <p class="mb-2 text-sm text-gray-400">
                    <strong>Carbon Counting</strong> is the process of quantifying the total amount of greenhouse gases (CO<sub>2</sub>e) emitted directly and indirectly by an individual, organization, or country over a specific period. It's the primary tool for measuring climate impact.
                </p>
                <p class="mb-4 text-sm text-gray-400">
                    The foundation for this entire process comes from the <strong>Intergovernmental Panel on Climate Change (IPCC)</strong>, which provides the scientific guidelines and consensus used globally. Organizations then translate these guidelines into actionable frameworks, most notably the <strong>Greenhouse Gas (GHG) Protocol</strong>, which structures how emissions are measured.
                </p>

                <!-- ======================================================= -->
                <!-- 3. Why Carbon Counting is Important and Examples -->
                <!-- ======================================================= -->
                <h2 class="text-xl font-semibold mt-6 mb-2">3. Why It Matters: Management and Mitigation</h2>
                <p class="mb-4 text-sm text-gray-400">
                    Counting carbon is essential because <strong>you cannot manage what you do not measure.</strong> It identifies emission hotspots and allows engineers to target the most effective areas for reduction.
                </p>
                
                <div class="p-3 bg-neutral-700 rounded-lg text-sm mb-4">
                    <p class="font-bold text-yellow-400 mb-1">Examples of Usage:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li><strong>Policy:</strong> Governments use national inventories (based on IPCC) to set climate targets and sign international treaties.</li>
                        <li><strong>Investment:</strong> Companies use carbon data to report to investors and set corporate sustainability goals (e.g., "Net-Zero by 2050").</li>
                        <li><strong>Engineering:</strong> Engineers use CO<sub>2</sub>e metrics in Life Cycle Assessments (LCA) to design lower-impact products.</li>
                    </ul>
                </div>

                <!-- ======================================================= -->
                <!-- 4. How to Do Carbon Counting (The Formula) -->
                <!-- ======================================================= -->
                <h2 class="text-xl font-semibold mt-6 mb-2">4. The Process: How to Do Carbon Counting</h2>
                <p class="mb-2 text-sm text-gray-400">
                    The process is based on a simple relationship that determines the emissions for any activity:
                </p>

                <!-- Core Formula -->
                <div class="bg-neutral-700 p-4 rounded-lg text-center text-lg font-mono">
                    CO‚ÇÇe = Activity Data &times; Emission Factor
                </div>

                <p class="mt-2 text-sm text-gray-400">
                    Where <strong>Activity Data</strong> is the amount of resource used (e.g., 100 kWh of electricity, 500 liters of gasoline), and the <strong>Emission Factor</strong> is the known CO<sub>2</sub>e intensity of that resource (e.g., 0.71 kg CO<sub>2</sub>e per kWh in Indonesia).
                </p>
                
                <h2 class="text-xl font-semibold mt-6 mb-2">5. Scope and Tier Breakdown</h2>
                <p class="mb-4 text-sm text-gray-400">
                    To manage the complexity of all possible emissions, the GHG Protocol divides them into three Scopes and organizes the quality of data into Tiers.
                </p>
                
                <!-- DYNAMIC DIAGRAM (Method 3) -->
                <div class="diagram-container" id="scope-diagram">
                    <!-- The diagram is now set via CSS background-image -->
                    
                    <!-- Hidden interactive hotspots (used by JS to trigger detailed view) -->
                    <div class="diagram-overlay">
                        <!-- Hotspots are approximated based on a typical diagram structure -->
                        <div class="scope-hotspot" data-scope="1" style="top: 30%; left: 30%; width: 20%; height: 30%;"></div>
                        <div class="scope-hotspot" data-scope="2" style="top: 20%; left: 55%; width: 25%; height: 40%;"></div>
                        <div class="scope-hotspot" data-scope="3" style="top: 10%; left: 5%; width: 90%; height: 80%;"></div>
                    </div>
                </div>

                <p class="text-sm text-gray-400 text-center mb-4">Click anywhere on the diagram above to see the detailed definitions of each Scope.</p>
                
                <!-- Detailed Scope Content - Starts Hidden, revealed by diagram click -->
                <div id="detailed-scopes" class="hidden">
                    <h3 class="text-lg font-medium mt-4">Scope Details</h3>
                    
                    <div id="scope-detail-1" class="scope-box mt-3 p-3 bg-red-800 bg-opacity-30 border-l-4 border-red-500 hidden" data-scope="1">
                        <h4 class="font-bold text-white">Scope 1: Direct Emissions (In My Backyard)</h4>
                        <p class="text-sm">Emissions directly from sources you control, like burning fuel in a generator or service vehicle fleet. <strong class="text-red-400">Example:</strong> Burning diesel in a campus bus.</p>
                    </div>

                    <div id="scope-detail-2" class="scope-box mt-3 p-3 bg-yellow-800 bg-opacity-30 border-l-4 border-yellow-500 hidden" data-scope="2">
                        <h4 class="font-bold text-white">Scope 2: Energy Consumption (My Utility Bill)</h4>
                        <p class="text-sm">Emissions from purchased electricity or steam. The factor for Indonesia's grid, the <span class="term" data-tooltip="Perusahaan Listrik Negara (PLN) is the state-owned utility grid, which heavily influences the national electricity emission factor.">PLN grid</span>, is approximately ~0.71 kg CO<sub>2</sub>/kWh.</p>
                    </div>

                    <div id="scope-detail-3" class="scope-box mt-3 p-3 bg-green-800 bg-opacity-30 border-l-4 border-green-500 hidden" data-scope="3">
                        <h4 class="font-bold text-white">Scope 3: Value Chain (Everything Else)</h4>
                        <p class="text-sm">All indirect emissions in the value chain, such as commuting, waste, and manufacturing of purchased goods. This is often the largest factor and the hardest to track, often requiring the use of <strong>Tiers</strong>.</p>
                        
                        <!-- Tiers Explanation -->
                        <div class="mt-2 p-2 bg-neutral-700 rounded text-xs">
                            <p class="font-bold text-yellow-400">Tiers Summary:</p>
                            <ul class="list-disc list-inside ml-2 space-y-1">
                                <li><strong>Tier 1 (Lowest Accuracy):</strong> Uses industry-average data (e.g., generic laptop CO<sub>2</sub> factor). Quick and cheap.</li>
                                <li><strong>Tier 2 (Medium Accuracy):</strong> Uses specific regional data (e.g., regional utility grid factor).</li>
                                <li><strong>Tier 3 (Highest Accuracy):</strong> Requires supplier-specific data collection (e.g., surveying the exact factory). The gold standard, but requires significant effort.</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <h2 class="text-xl font-semibold mt-6 mb-2">Example Calculation (Scope 2)</h2>
                <p class="text-sm">
                    To calculate the emissions from 100 kWh of electricity (Scope 2):
                </p>
                <div class="bg-neutral-700 p-3 rounded-lg text-sm font-mono mt-2">
                    100 kWh &times; 0.71 kg CO‚ÇÇ/kWh = 71 kg CO‚ÇÇe
                </div>

                <!-- ======================================================= -->
                <!-- NEW SECTION: USEFUL LINKS -->
                <!-- ======================================================= -->
                <h2 class="text-xl font-semibold mt-6 mb-2">Useful Links</h2>
                <div class="p-3 bg-neutral-700 rounded-lg text-sm mb-4 space-y-3">
                    <p class="font-bold text-yellow-400">Emission Factors:</p>
                    <ul class="list-disc list-inside ml-4 space-y-1">
                        <li><a href="https://www.ipcc-nggip.iges.or.jp/EFDB/main.php" target="_blank" class="useful-link"><strong>a. IPCC Emission Factor Database (EFDB):</strong></a> The core scientific repository for global inventory factors.</li>
                        <li><a href="https://www.gov.uk/government/publications/greenhouse-gas-reporting-conversion-factors-2025" target="_blank" class="useful-link"><strong>b. UK Government Conversion Factors (DEFRA/DESNZ):</strong></a> Excellent annual database for specific activities (e.g., transport, materials).</li>
                        <li><a href="https://www.epa.gov/climateleadership/ghg-emission-factors-hub" target="_blank" class="useful-link"><strong>c. US EPA GHG Emission Factors Hub:</strong></a> Regularly updated factors, especially useful for energy and waste.</li>
                    </ul>

                    <p class="font-bold text-yellow-400 pt-3">Simulation:</p>
                    <a href="ipcc-simulator.html" target="_blank" class="useful-link block ml-4">Go to the Interactive Carbon Simulator (ipcc-simulator.html) &rarr;</a>
                </div>
                
            </div>
            <!-- END OF ORIGINAL METHODOLOGY CONTENT -->
        </div>
    </div>

    <script>
        
        // =======================================================
        // MODAL CONTROL FUNCTIONS
        // =======================================================
        
        // Opens the modal (Simulates clicking the Methodology button)
        function openModal() {
            const modalBackdrop = document.getElementById('modal-backdrop');
            modalBackdrop.classList.remove('hidden-modal');
            document.body.style.overflow = 'hidden'; // Prevent scrolling on the main page
        }

        // Closes the modal (Called by clicking the backdrop)
        function closeModal(event) {
            // Check if the click occurred directly on the backdrop
            if (event.target.id === 'modal-backdrop') {
                const modalBackdrop = document.getElementById('modal-backdrop');
                modalBackdrop.classList.add('hidden-modal');
                document.body.style.overflow = ''; // Restore scrolling
            }
            // Note: The event.stopPropagation() call on the content box prevents accidental closure.
        }

        // =======================================================
        // METHOD 1: INTERACTIVE GLOSSARY SETUP
        // =======================================================

        function initGlossary() {
            const terms = document.querySelectorAll('.term');
            terms.forEach(term => {
                const tooltipText = term.getAttribute('data-tooltip');
                if (tooltipText) {
                    const tooltip = document.createElement('div');
                    tooltip.className = 'tooltip-box';
                    tooltip.textContent = tooltipText;
                    term.appendChild(tooltip);
                }
            });
        }

        // =======================================================
        // METHOD 3: DYNAMIC DIAGRAM LABELER (FIXED INTERACTION)
        // =======================================================

        function initDiagramInteraction() {
            const hotspots = document.querySelectorAll('.scope-hotspot');
            const detailedScopesContainer = document.getElementById('detailed-scopes');
            const scopeBoxes = document.querySelectorAll('.scope-box');
            
            // Reference the section where the details appear
            const targetSection = document.getElementById('detailed-scopes'); 

            const showScopeDetail = (scope) => {
                detailedScopesContainer.classList.remove('hidden');
                
                scopeBoxes.forEach(box => {
                    if (box.getAttribute('data-scope') === scope) {
                        box.classList.remove('hidden');
                    } else {
                        box.classList.add('hidden');
                    }
                });
                
                // Scroll immediately to the target section within the modal
                if (targetSection) {
                    targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            };

            // 1. Hotspot Click Handler
            hotspots.forEach(hotspot => {
                const scope = hotspot.getAttribute('data-scope');
                hotspot.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showScopeDetail(scope);
                });
            });

            // 2. Diagram Container Click Handler (For general click on diagram area)
            const diagramContainer = document.getElementById('scope-diagram');
            diagramContainer.addEventListener('click', (e) => {
                // If the click is on the container and not a hotspot, default to Scope 3
                if (e.target.id === 'scope-diagram' || e.target.classList.contains('diagram-overlay')) {
                    showScopeDetail('3'); // Default to Scope 3 as it's the largest/most complex
                }
            });
        }
        
        // =======================================================
        // INIT
        // =======================================================
        document.addEventListener('DOMContentLoaded', () => {
            initGlossary();
            initDiagramInteraction();
            
            // DEMO: Automatically open modal on page load to show content
            openModal(); 
        });
    </script>
</body>
</html>
